Add atomic file updates with automatic rollback on errors.
